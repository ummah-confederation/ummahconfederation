class IndexedDBCache{constructor(t="ummah-cache",e="responses",i=1){this.dbName=t,this.storeName=e,this.version=i,this.db=null}async init(){return this.db?this.db:new Promise((t,e)=>{const i=indexedDB.open(this.dbName,this.version);i.onerror=()=>e(new Error(`Failed to open database: ${i.error}`)),i.onsuccess=()=>{this.db=i.result,t(this.db)},i.onupgradeneeded=t=>{const e=t.target.result;if(!e.objectStoreNames.contains(this.storeName)){const t=e.createObjectStore(this.storeName,{keyPath:"key"});t.createIndex("timestamp","timestamp",{unique:!1}),t.createIndex("ttl","ttl",{unique:!1})}}})}async get(t){try{const e=await this.init();return new Promise((i,a)=>{const n=e.transaction([this.storeName],"readonly").objectStore(this.storeName).get(t);n.onsuccess=()=>{const e=n.result;if(!e)return void i(null);Date.now()-e.timestamp<e.ttl?i(e.value):(this.delete(t).catch(console.warn),i(null))},n.onerror=()=>a(new Error(`Failed to get from cache: ${n.error}`))})}catch(t){return null}}async set(t,e,i=3e5){try{const a=await this.init();return new Promise((n,s)=>{const r=a.transaction([this.storeName],"readwrite"),o=r.objectStore(this.storeName),c={key:t,value:e,timestamp:Date.now(),ttl:i},h=o.put(c);h.onsuccess=()=>n(),h.onerror=()=>s(new Error(`Failed to set cache: ${h.error}`)),r.oncomplete=()=>n(),r.onerror=()=>s(new Error(`Transaction failed: ${r.error}`))})}catch(t){}}async getOrFetch(t,e,i){const a=await this.get(t);if(null!==a)return a;const n=await e();return await this.set(t,n,i),n}async getOrFetchStale(t,e,i,a=.8*i){try{const n=await this.init();return new Promise((s,r)=>{const o=n.transaction([this.storeName],"readonly").objectStore(this.storeName).get(t);o.onsuccess=()=>{const n=o.result;if(!n)return void e().then(e=>{this.set(t,e,i).catch(console.warn),s(e)}).catch(r);const c=Date.now()-n.timestamp;c<n.ttl?(c>a&&this.refreshInBackground(t,e,i),s(n.value)):(this.delete(t).catch(console.warn),e().then(e=>{this.set(t,e,i).catch(console.warn),s(e)}).catch(r))},o.onerror=()=>{e().then(e=>{this.set(t,e,i).catch(console.warn),s(e)}).catch(r)}})}catch(t){return e()}}async refreshInBackground(t,e,i){try{const a=await e();await this.set(t,a,i)}catch(t){}}async delete(t){try{const e=await this.init();return new Promise((i,a)=>{const n=e.transaction([this.storeName],"readwrite"),s=n.objectStore(this.storeName).delete(t);s.onsuccess=()=>i(),s.onerror=()=>a(new Error(`Failed to delete from cache: ${s.error}`)),n.oncomplete=()=>i(),n.onerror=()=>a(new Error(`Transaction failed: ${n.error}`))})}catch(t){}}async clear(){try{const t=await this.init();return new Promise((e,i)=>{const a=t.transaction([this.storeName],"readwrite"),n=a.objectStore(this.storeName).clear();n.onsuccess=()=>e(),n.onerror=()=>i(new Error(`Failed to clear cache: ${n.error}`)),a.oncomplete=()=>e(),a.onerror=()=>i(new Error(`Transaction failed: ${a.error}`))})}catch(t){}}async clearExpired(){try{const t=await this.init();return new Promise((e,i)=>{const a=t.transaction([this.storeName],"readwrite").objectStore(this.storeName).index("timestamp").openCursor();let n=0;const s=Date.now();a.onsuccess=t=>{const i=t.target.result;if(i){const t=i.value;s-t.timestamp>=t.ttl&&(i.delete(),n++),i.continue()}else e(n)},a.onerror=()=>i(new Error(`Failed to clear expired: ${a.error}`))})}catch(t){return 0}}async keys(){try{const t=await this.init();return new Promise((e,i)=>{const a=t.transaction([this.storeName],"readonly").objectStore(this.storeName).getAllKeys();a.onsuccess=()=>e(a.result),a.onerror=()=>i(new Error(`Failed to get keys: ${a.error}`))})}catch(t){return[]}}async getStats(){try{const t=await this.init();return new Promise((e,i)=>{const a=t.transaction([this.storeName],"readonly").objectStore(this.storeName).getAll();a.onsuccess=()=>{const t=a.result,i=Date.now();let n=0,s=0,r=0;t.forEach(t=>{const e=JSON.stringify(t).length;r+=e,i-t.timestamp<t.ttl?n++:s++}),e({totalEntries:t.length,validEntries:n,expiredEntries:s,totalBytes:r,totalKB:(r/1024).toFixed(2),avgEntrySize:t.length>0?(r/t.length).toFixed(2):0})},a.onerror=()=>i(new Error(`Failed to get stats: ${a.error}`))})}catch(t){return{totalEntries:0,validEntries:0,expiredEntries:0,totalBytes:0,totalKB:0,avgEntrySize:0}}}async close(){this.db&&(this.db.close(),this.db=null)}async deleteDatabase(){return await this.close(),new Promise((t,e)=>{const i=indexedDB.deleteDatabase(this.dbName);i.onsuccess=()=>t(),i.onerror=()=>e(new Error(`Failed to delete database: ${i.error}`))})}}const t="prayer",e="geocoding",i="location",a={PRAYER_TIMES:864e5};const n=new class{constructor(){this.memoryCache=new Map,this.idbCache=new IndexedDBCache("ummah-unified-cache","cache"),this.initialized=!1,this.initPromise=null}async init(){if(!this.initialized)return this.initPromise||(this.initPromise=this._doInit()),this.initPromise}async _doInit(){try{await this.idbCache.init(),this.initialized=!0}catch(t){this.initialized=!0}}generateKey(t,...e){return`${t}:${e.join(":")}`}generateLocationKey(t,e,i,...a){const n=e.toFixed(4),s=i.toFixed(4);return this.generateKey(t,n,s,...a)}async get(t){if(this.memoryCache.has(t)){const e=this.memoryCache.get(t);if(Date.now()-e.timestamp<e.ttl)return e.value;this.memoryCache.delete(t)}try{const e=await this.idbCache.get(t);if(null!==e)return this.memoryCache.set(t,{value:e,timestamp:Date.now(),ttl:a.PRAYER_TIMES}),e}catch(t){}return null}async set(t,e,i=a.PRAYER_TIMES){const n={value:e,timestamp:Date.now(),ttl:i};this.memoryCache.set(t,n);try{await this.idbCache.set(t,e,i)}catch(t){}}async delete(t){this.memoryCache.delete(t);try{await this.idbCache.delete(t)}catch(t){}}async invalidateNamespace(t){const e=t+":";for(const t of this.memoryCache.keys())t.startsWith(e)&&this.memoryCache.delete(t);try{const t=await this.idbCache.keys();for(const i of t)i.startsWith(e)&&await this.idbCache.delete(i)}catch(t){}}async clear(){this.memoryCache.clear();try{await this.idbCache.clear()}catch(t){}}async clearExpired(){let t=0;const e=Date.now();for(const[i,a]of this.memoryCache.entries())e-a.timestamp>=a.ttl&&(this.memoryCache.delete(i),t++);try{t+=await this.idbCache.clearExpired()}catch(t){}return t}async getStats(){const t=this.memoryCache.size;let e={totalEntries:0,validEntries:0,expiredEntries:0};try{e=await this.idbCache.getStats()}catch(t){}return{memoryEntries:t,...e,totalEntries:t+e.totalEntries}}async getOrFetch(t,e,i){const a=await this.get(t);if(null!==a)return a;const n=await e();return await this.set(t,n,i),n}async getOrFetchStale(t,e,i,a=.8*i){if(this.memoryCache.has(t)){const n=this.memoryCache.get(t),s=Date.now()-n.timestamp;if(s<n.ttl){const r=s>a;return r&&this._refreshInBackground(t,e,i),{value:n.value,isStale:r}}}try{const e=await this.idbCache.get(t);if(null!==e)return this.memoryCache.set(t,{value:e,timestamp:Date.now(),ttl:i}),{value:e,isStale:!0}}catch(t){}const n=await e();return await this.set(t,n,i),{value:n,isStale:!1}}async _refreshInBackground(t,e,i){try{const a=await e();await this.set(t,a,i)}catch(t){}}};"undefined"!=typeof window&&n.init().catch(console.warn);const s="gps_fresh",r="gps_cached",o="fallback",c={enableHighAccuracy:!1,timeout:1e4,maximumAge:3e5},h=["https://corsproxy.io/?","https://api.allorigins.win/raw?url="],l={latitude:-6.2088,longitude:106.8456,city:"Jakarta",country:"Indonesia"},d={LOCATION:18e5,GEOCODING:6048e5},u=["Fajr","Dhuhr","Asr","Maghrib","Isha"];const y=new class{constructor(){this.location=null,this.prayerTimes=null,this.nextPrayer=null,this.timeToNextPrayer=null,this.isLoading=!1,this.error=null,this.lastDate=null,this.listeners=new Set,this.initialized=!1,this.initPromise=null,this.updateInterval=null,this.handleOnline=this.handleOnline.bind(this),this.handleOffline=this.handleOffline.bind(this),this.handleVisibilityChange=this.handleVisibilityChange.bind(this)}async init(t={}){if(!this.initialized)return this.initPromise||(this.initPromise=this._doInit(t)),this.initPromise}async _doInit(t){try{this.isLoading=!0,this.notifyListeners("loading"),await n.init(),this.location=await this.getLocation({forceRefresh:t.forceRefresh}),this.prayerTimes=await this.fetchPrayerTimes(),this.calculateNextPrayer(),this.setupEventHandlers(),this.setupUpdateInterval(),this.setupDateChangeDetection(),this.initialized=!0,this.isLoading=!1,this.error=null,this.notifyListeners("initialized")}catch(t){throw this.error=t,this.isLoading=!1,this.notifyListeners("error",t),t}}async getLocation(t={}){const{forceRefresh:a=!1,maxAge:o=d.LOCATION}=t,c=n.generateKey(i,"current");if(!a){const t=await n.get(c);if(t&&this.isLocationFresh(t,o)){if((!t.city||"Unknown"===t.city)&&t.latitude&&t.longitude)try{const i=n.generateLocationKey(e,t.latitude,t.longitude),a=await n.get(i);a&&(t.city=a.city,t.country=a.country)}catch(t){}return{...t,quality:r}}}try{const t=await this.requestGPSPosition(),e={latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy,timestamp:Date.now(),quality:s};try{await this.fetchCityName(e)}catch(t){}return await n.set(c,e,d.LOCATION),e}catch(t){return this.getLocationFallback(t,c)}}requestGPSPosition(){return new Promise((t,e)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t,e,c):e(new Error("Geolocation not supported"))})}async getLocationFallback(t,i){const a=await this.getExpiredLocationCache(i);if(a&&a.quality!==o){if(!a.city||"Unknown"===a.city)try{const t=n.generateLocationKey(e,a.latitude,a.longitude),i=await n.get(t);i&&(a.city=i.city,a.country=i.country)}catch(t){}return{...a,quality:r,isExpired:!0}}return{...l,quality:o,fallbackReason:this.getGPSErrorMessage(t),timestamp:Date.now()}}async getExpiredLocationCache(t){try{if(!n.idbCache||!n.idbCache.db)return null;const e=n.idbCache.db;return new Promise(i=>{const a=e.transaction(["cache"],"readonly").objectStore("cache").get(t);a.onsuccess=()=>{const t=a.result;t&&t.value?i(t.value):i(null)},a.onerror=()=>i(null)})}catch(t){return null}}isLocationFresh(t,e){return!(!t||!t.timestamp)&&Date.now()-t.timestamp<e}getGPSErrorMessage(t){switch(t.code){case t.PERMISSION_DENIED:return"Permission denied";case t.POSITION_UNAVAILABLE:return"Position unavailable";case t.TIMEOUT:return"Request timed out";default:return t.message||"Unknown error"}}async fetchCityName(t){if(!t||t.quality===o)return;const i=n.generateLocationKey(e,t.latitude,t.longitude);try{const e=await n.get(i);if(e)return t.city=e.city,void(t.country=e.country)}catch(t){}try{const e=new AbortController,a=setTimeout(()=>e.abort(),5e3),s=await fetch(`/api/geocode?lat=${t.latitude}&lon=${t.longitude}`,{signal:e.signal});if(clearTimeout(a),s.ok){const e=await s.json();return t.city=e.city||"Unknown",t.country=e.country||"Unknown",await n.set(i,{city:t.city,country:t.country},d.GEOCODING),void await this.updateLocationCache(t)}}catch(t){}const a=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${t.latitude}&lon=${t.longitude}`;for(const e of h)try{const s=new AbortController,r=setTimeout(()=>s.abort(),5e3),o=await fetch(`${e}${encodeURIComponent(a)}`,{signal:s.signal});if(clearTimeout(r),!o.ok)continue;const c=await o.json();return t.city=c.address.city||c.address.town||c.address.village||c.address.county||"Unknown",t.country=c.address.country||"Unknown",await n.set(i,{city:t.city,country:t.country},d.GEOCODING),void await this.updateLocationCache(t)}catch(t){}t.city="Unknown",t.country="Unknown"}async updateLocationCache(t){if(!t)return;const e=n.generateKey(i,"current");try{await n.set(e,t,d.LOCATION)}catch(t){}}generatePrayerCacheKey(e){if(!e)return null;const i=(new Date).toLocaleDateString("en-CA",{timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone});return n.generateLocationKey(t,e.latitude,e.longitude,i,e.quality)}calculatePrayerTTL(){const t=new Date,e=Intl.DateTimeFormat().resolvedOptions().timeZone,i=t.toLocaleDateString("en-CA",{timeZone:e})+"T23:59:59",a=new Date(i).getTime()-t.getTime()+3e5;return Math.max(a,6e4)}async fetchPrayerTimes(t=this.location){if(!t)throw new Error("Location not available");const e=this.generatePrayerCacheKey(t);try{const i=await n.get(e);if(i){const e=new Date(i.date),a=new Date;if(e.toDateString()===a.toDateString()){const e=Date.now()-new Date(i.date).getTime();return e>72e6&&this.refreshPrayerTimesInBackground(t),i.prayerTimes}}}catch(t){}return this.fetchPrayerTimesFromAPI(t)}async fetchPrayerTimesFromAPI(t){const e=new Date,i=`https://api.aladhan.com/v1/timings/${e.getDate()}-${e.getMonth()+1}-${e.getFullYear()}?latitude=${t.latitude}&longitude=${t.longitude}&method=20`;try{const e=await fetch(i),a=await e.json();if(200===a.code&&a.data){const e={};return u.forEach(t=>{e[t]=a.data.timings[t]}),await this.cachePrayerTimes(t,e),e}throw new Error("Invalid API response")}catch(t){throw t}}async cachePrayerTimes(t,e){const i=this.generatePrayerCacheKey(t);if(!i)return;const a={date:(new Date).toISOString(),prayerTimes:e,location:{latitude:t.latitude,longitude:t.longitude,quality:t.quality}},s=this.calculatePrayerTTL();await n.set(i,a,s)}async refreshPrayerTimesInBackground(t=this.location){try{const e=await this.fetchPrayerTimesFromAPI(t);this.prayerTimes=e,this.notifyListeners("prayer-times-updated")}catch(t){}}calculateNextPrayer(){if(!this.prayerTimes)return null;const t=new Date,e=60*t.getHours()+t.getMinutes(),i=u.map(t=>{const[e,i]=this.prayerTimes[t].split(":").map(Number);return{name:t,time:this.prayerTimes[t],minutes:60*e+i}});let a=null;for(const t of i)if(t.minutes>e){a=t;break}if(a)this.timeToNextPrayer=a.minutes-e;else{a=i[0];const t=1440-e;this.timeToNextPrayer=t+a.minutes}return this.nextPrayer=a,a}formatTimeToNextPrayer(){if(null===this.timeToNextPrayer)return"";const t=Math.floor(this.timeToNextPrayer/60),e=this.timeToNextPrayer%60;return t>0?`${t}h ${e}m`:`${e}m`}formatDate(){return(new Date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})}formatCurrentTime(t=!1){const e={hour:"2-digit",minute:"2-digit",hour12:!0};return t&&(e.second="2-digit"),(new Date).toLocaleTimeString("en-US",e)}formatLocation(){if(!this.location)return"Unknown";return`${this.location.city||"Unknown"}, ${this.location.country||"Unknown"}${this.location.quality===o?" (Fallback)":""}`}getState(){return{location:this.location,prayerTimes:this.prayerTimes,nextPrayer:this.nextPrayer,timeToNextPrayer:this.timeToNextPrayer,formattedTimeToNext:this.formatTimeToNextPrayer(),isLoading:this.isLoading,error:this.error,formattedDate:this.formatDate(),formattedTime:this.formatCurrentTime(),formattedLocation:this.formatLocation()}}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notifyListeners(t,e){const i=this.getState();this.listeners.forEach(a=>{try{a(i,t,e)}catch(t){}})}setupEventHandlers(){window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline),document.addEventListener("visibilitychange",this.handleVisibilityChange)}handleOnline(){this.refreshPrayerTimesInBackground()}handleOffline(){}handleVisibilityChange(){"visible"===document.visibilityState&&(this.calculateNextPrayer(),this.notifyListeners("visibility-change"))}setupUpdateInterval(){this.updateInterval&&clearInterval(this.updateInterval),this.updateInterval=setInterval(()=>{this.calculateNextPrayer(),this.notifyListeners("tick")},1e3)}setupDateChangeDetection(){this.lastDate=(new Date).toDateString(),setInterval(()=>{const t=(new Date).toDateString();this.lastDate!==t&&(this.lastDate=t,this.invalidatePrayerTimesCache())},6e4)}async invalidateLocationCache(){await n.invalidateNamespace(i),this.location=null,this.notifyListeners("location-invalidated")}async invalidatePrayerTimesCache(){await n.invalidateNamespace(t),this.prayerTimes=null;try{this.prayerTimes=await this.fetchPrayerTimes(),this.calculateNextPrayer(),this.notifyListeners("prayer-times-updated")}catch(t){}}async invalidateAllCaches(){await this.invalidateLocationCache(),await this.invalidatePrayerTimesCache()}async forceRefresh(){this.isLoading=!0,this.notifyListeners("loading");try{this.location=await this.getLocation({forceRefresh:!0}),this.prayerTimes=await this.fetchPrayerTimesFromAPI(this.location),this.calculateNextPrayer(),this.error=null,this.isLoading=!1,this.notifyListeners("refreshed")}catch(t){this.error=t,this.isLoading=!1,this.notifyListeners("error",t)}}destroy(){this.updateInterval&&clearInterval(this.updateInterval),window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline),document.removeEventListener("visibilitychange",this.handleVisibilityChange),this.listeners.clear(),this.initialized=!1}};class Marquee{constructor(){this.marqueeElement=null,this.feedConfig=null,this.feedDocuments=[],this.feedType=null,this.entityName=null,this.entityMetadata=null,this.cachedContent=null,this.cachedContentHash=null,this.unsubscribe=null}async init(){if(this.marqueeElement=document.getElementById("prayer-times-marquee"),this.marqueeElement){this.marqueeElement.style.cursor="pointer",this.marqueeElement.addEventListener("click",()=>{this.navigateToFeed()});try{this.getFeedContext(),await this.fetchFeedConfig(),await this.fetchEntityMetadata();!1!==this.feedConfig?.widget?.enabled?(this.showLoadingState(),this.unsubscribe=y.subscribe((t,e)=>{this.handleServiceUpdate(t,e)}),await y.init()):this.updateDisplay()}catch(t){this.showError()}}}handleServiceUpdate(t,e){switch(e){case"loading":t.prayerTimes||this.showLoadingState();break;case"initialized":case"refreshed":case"tick":case"location-updated":case"prayer-times-updated":case"visibility-change":default:this.updateDisplay();break;case"error":t.prayerTimes||this.showWarningState(t.error?.message||"Unable to load prayer times")}}showLoadingState(){this.marqueeElement&&(this.marqueeElement.innerHTML='\n      <span class="prayer-loading">\n        <span class="loading-spinner"></span>\n        Fetching your location...\n      </span>\n    ')}showWarningState(t,e=!0){if(!this.marqueeElement)return;const i=e?'<button class="retry-location-btn" title="Retry location fetch">üîÑ</button>':"";if(this.marqueeElement.innerHTML=`\n      <span class="prayer-warning">\n        ‚ö†Ô∏è ${t} ${i}\n      </span>\n    `,e){const t=this.marqueeElement.querySelector(".retry-location-btn");t&&t.addEventListener("click",t=>{t.stopPropagation(),this.retryLocationFetch()})}}async retryLocationFetch(){this.showLoadingState();try{await y.forceRefresh()}catch(t){this.showWarningState("Location fetch failed. Using fallback location.")}}getFeedContext(){const t=new URLSearchParams(window.location.search),e=t.get("institution"),i=t.get("jurisdiction");e?(this.feedType="institution",this.entityName=e):i?(this.feedType="jurisdiction",this.entityName=i):(this.feedType="global",this.entityName=null)}async fetchFeedConfig(){if("global"!==this.feedType)try{const{getInstitutionFeedConfig:t,getJurisdictionFeedConfig:e,getFeedDocuments:i}=await import("./config-D_mrtKXL.js");if("institution"===this.feedType){this.feedConfig=await t(this.entityName);const e=await i("institution",this.entityName);this.feedDocuments=e}else if("jurisdiction"===this.feedType){this.feedConfig=await e(this.entityName);const t=await i("jurisdiction",this.entityName);this.feedDocuments=t}}catch(t){this.feedConfig=null,this.feedDocuments=[]}else this.feedConfig=null}async fetchEntityMetadata(){if(this.entityName)try{const{getInstitutionMetadata:t,getJurisdictionMetadata:e}=await import("./config-D_mrtKXL.js");"institution"===this.feedType?this.entityMetadata=await t(this.entityName):"jurisdiction"===this.feedType&&(this.entityMetadata=await e(this.entityName))}catch(t){this.entityMetadata=null}else this.entityMetadata=null}updateDisplay(){if(!this.marqueeElement)return;const t=!1!==this.feedConfig?.widget?.enabled;let e="";if(t){const t=y.getState();if(t.error&&!t.prayerTimes)return void this.showWarningState(t.error.message||"Unable to load prayer times");if(t.isLoading&&!t.prayerTimes)return void this.showLoadingState();const i=t.formattedLocation,a=t.formattedTimeToNext,n=t.nextPrayer?.name||"Unknown";e=`<span class="prayer-item"><span class="prayer-label">üìç</span> <span class="prayer-value">${i}</span></span> <span class="prayer-separator">‚Ä¢</span> <span class="prayer-item"><span class="prayer-label">üìÖ</span> <span class="prayer-value">${t.formattedDate}</span></span> <span class="prayer-separator">‚Ä¢</span> <span class="prayer-item"><span class="prayer-label">üïê</span> <span class="prayer-value">${t.formattedTime}</span></span> <span class="prayer-separator">‚Ä¢</span> <span class="prayer-item"><span class="prayer-label">‚è∞</span> <span class="prayer-value">${n} (${a})</span></span>`}let i=`${e} <span class="prayer-separator">‚Ä¢</span> `;if(!e&&this.entityMetadata?.bio){i=`<span class="prayer-item"><span class="prayer-value">${this.entityMetadata.bio}</span></span> <span class="prayer-separator">‚Ä¢</span> `}const a=this.generateContentHash(e,"",this.entityMetadata?.bio);if(this.cachedContentHash!==a){const t=window.innerWidth,e=document.createElement("div");e.style.visibility="hidden",e.style.position="absolute",e.style.whiteSpace="nowrap",e.innerHTML=i,document.body.appendChild(e);const n=e.offsetWidth;if(document.body.removeChild(e),n<2*t){const e=Math.ceil(2*t/n)+1;i=Array(e).fill(i.trim()).join(" ")}this.cachedContent=i,this.cachedContentHash=a}else{if(t&&this.cachedContent){const t=y.getState(),e=/<span class="prayer-value">(\d{1,2}:\d{2}\s[AP]M)<\/span>/,i=this.cachedContent.match(e);i&&(this.cachedContent=this.cachedContent.replace(i[0],`<span class="prayer-value">${t.formattedTime}</span>`))}i=this.cachedContent}this.marqueeElement.innerHTML=i+i,this.setScrollSpeed()}generateContentHash(t,e,i){return`${t?t.replace(/\d{1,2}:\d{2}\s[AP]M/g,"TIME"):""}|${e}|${i||""}`}setScrollSpeed(){const t=this.marqueeElement.scrollWidth/2/30;this.marqueeElement.style.animation=`scroll ${t}s linear infinite`}showError(){this.marqueeElement&&(this.marqueeElement.innerHTML='\n      <span class="prayer-error">Unable to load marquee content. Please check your connection.</span>\n    ')}navigateToFeed(){const t=new URLSearchParams(window.location.search),e=t.get("institution"),i=t.get("jurisdiction");let a="feed.html";e?a=`feed.html?institution=${encodeURIComponent(e)}`:i&&(a=`feed.html?jurisdiction=${encodeURIComponent(i)}`),window.location.href=a}destroy(){this.unsubscribe&&this.unsubscribe()}}if("loading"===document.readyState)document.addEventListener("DOMContentLoaded",()=>{(new Marquee).init()});else{(new Marquee).init()}export{Marquee};
