const t="1.0.0";let n=null,e=null,i=null,o=null;let a={documents:0,institutions:0,jurisdictions:0,squircleIcons:0};function s(t){const n=Date.now();return a[t]&&n-a[t]<3e5}function c(t){a[t]=Date.now()}async function r(n,e=!0){const i=e?`?v=${t}&t=${Date.now()}`:`?t=${Date.now()}`;return fetch(n+i,{cache:"no-store",headers:{Accept:"application/json"}})}async function l(){if(n&&s("documents"))return n;try{const t=await r("config/documents-config.json");if(!t.ok)throw new Error(`Failed to load config: ${t.status} ${t.statusText}`);const e=await t.json();return n=e,c("documents"),e}catch(t){throw t}}async function d(){if(e&&s("institutions"))return e;try{const t=await r("config/institution-config.json");if(!t.ok)throw new Error(`Failed to load institution config: ${t.status} ${t.statusText}`);const n=await t.json();return e=n,c("institutions"),n}catch(t){return{institutions:{}}}}async function u(){if(i&&s("jurisdictions"))return i;try{const t=await r("config/jurisdiction-config.json");if(!t.ok)throw new Error(`Failed to load jurisdiction config: ${t.status} ${t.statusText}`);const n=await t.json();return i=n,c("jurisdictions"),n}catch(t){return{jurisdictions:{}}}}async function m(t){const n=await d();return n.institutions?.[t]||null}async function f(){return(await l()).documents.filter(t=>!1!==t.visible)}async function p(){if(o&&s("squircleIcons"))return o;try{const t=await r("config/squircle-icons-config.json");if(!t.ok)throw new Error(`Failed to load squircle icons config: ${t.status} ${t.statusText}`);const n=await t.json();return o=n,c("squircleIcons"),n}catch(t){return{icons:{}}}}function v(){n=null,e=null,i=null,o=null,a={documents:0,institutions:0,jurisdictions:0,squircleIcons:0}}function w(){const t=new URLSearchParams(window.location.search);return{item:t.get("item"),institution:t.get("institution"),jurisdiction:t.get("jurisdiction")}}function h(){const t=window.location.hash.slice(1);if(!t)return{item:null,institution:null,jurisdiction:null};const n=new URLSearchParams(t);return{item:n.get("item"),institution:n.get("institution"),jurisdiction:n.get("jurisdiction")}}function y(t,n){const e=[...t];switch(n){case"name":return e.sort((t,n)=>t.title.localeCompare(n.title));case"version":return e.sort((t,n)=>{const e=n.version-t.version;return 0!==e?e:new Date(n.date)-new Date(t.date)});case"date":return e.sort((t,n)=>new Date(n.date)-new Date(t.date));default:return e}}function b(t,n){return t.filter(t=>(!n.item||t.item.toLowerCase()===n.item.toLowerCase())&&((!n.institution||t.institution.toLowerCase()===n.institution.toLowerCase())&&(!n.jurisdiction||t.jurisdiction.toLowerCase()===n.jurisdiction.toLowerCase())))}function g(t){const n=document.createElement("div");return n.textContent=t,n.innerHTML}"undefined"!=typeof window&&(window.clearConfigCache=v,window.getCacheVersion=function(){return t},window.setCacheVersion=function(t){v()});const $={profileType:null,profileName:null,currentFilter:"all",documents:[],profileData:null,availableTypes:[]};let j=null;function E(t){const n=t.match(/^(.+?)\s*\[(.*?)\]\s*$/);return n?{name:n[1].trim(),label:n[2].trim()}:{name:t.trim(),label:""}}function L(){let t=w();return t.institution||t.jurisdiction||(t=h()),t.institution?{type:"institution",name:t.institution}:t.jurisdiction?{type:"jurisdiction",name:t.jurisdiction}:null}async function x(t){j=t;const n=L();if(!n)return void function(){const t=document.getElementById("profile-container");t&&t.classList.add("hidden")}();$.profileType=n.type,$.profileName=n.name;const e=await f();var i;$.documents=e.filter(t=>"institution"===$.profileType?t.institution===$.profileName:t.jurisdiction===$.profileName),$.availableTypes=(i=$.documents,["all",...[...new Set(i.map(t=>t.item))].sort((t,n)=>t.localeCompare(n))]),"institution"===$.profileType?$.profileData=await m($.profileName):$.profileData=await async function(t){const n=await u();return n.jurisdictions?.[t]||null}($.profileName),function(){!function(){const t=document.getElementById("profile-container");t&&t.classList.remove("hidden")}();const t=document.getElementById("profile-header");if(!t)return;const{name:n,label:e}=E($.profileName),i=$.profileData||{},o=i.cover||"./images/default-cover.jpg",a=i.avatar||"./images/default-avatar.jpg",s=i.bio||"";let c="";if("institution"===$.profileType){const t=function(t,n){return t.filter(t=>t.institution===n).length}($.documents,$.profileName);c=`${t} Contributions`}else{const t=function(t,n){return new Set(t.filter(t=>t.jurisdiction===n).map(t=>t.institution)).size}($.documents,$.profileName);c=`${t} Contributors`}const r="institution"===$.profileType?"Contact":"Contributors";t.innerHTML=`\n    <div class="profile-cover">\n      <img src="${g(o)}" alt="Cover" loading="lazy" decoding="async" />\n    </div>\n    <div class="profile-info">\n      <div class="profile-header-row">\n        <div class="profile-avatar">\n          <img src="${g(a)}" alt="${g(n)}" loading="eager" fetchpriority="high" />\n        </div>\n        <div class="profile-actions">\n          <button class="profile-button" id="profile-action-btn">${g(r)}</button>\n        </div>\n      </div>\n      <div class="profile-details-section">\n        <h1 class="profile-name">${g(n)}</h1>\n        ${e?`<span class="profile-label">${g(e)}</span>`:""}\n        <span class="profile-count">${g(c)}</span>\n        ${s?`<p class="profile-bio">${g(s)}</p>`:""}\n      </div>\n    </div>\n  `;const l=document.getElementById("profile-action-btn");l&&l.addEventListener("click",T)}(),function(){const t=document.getElementById("profile-filters");if(!t)return;const n=$.availableTypes;t.innerHTML=`\n    <div class="filter-pills-container">\n      ${n.map(t=>{return`\n        <button \n          class="filter-pill ${t===$.currentFilter?"active":""}" \n          data-type="${g(t)}"\n        >\n          <span class="filter-pill-icon">\n            ${function(t){return{all:"üìÇ",book:"üìö",guideline:"üíé",policy:"üìã",decision:"‚ÑπÔ∏è",verdict:"‚öñÔ∏è",note:"üìé"}[t.toLowerCase()]||"üìÑ"}(t)}\n          </span>\n          <span class="filter-pill-label">${g((n=t,n.charAt(0).toUpperCase()+n.slice(1)))}</span>\n        </button>\n      `;var n}).join("")}\n    </div>\n  `,t.querySelectorAll(".filter-pill").forEach(t=>{t.addEventListener("click",()=>{!function(t){$.currentFilter=t,document.querySelectorAll(".filter-pill").forEach(n=>{n.classList.toggle("active",n.dataset.type===t)}),j&&j(t)}(t.dataset.type)})})}()}function C(){return"all"===$.currentFilter?$.documents:$.documents.filter(t=>t.item.toLowerCase()===$.currentFilter.toLowerCase())}function T(){"institution"===$.profileType?async function(){const t=$.profileData||{},{name:n,label:e}=E($.profileName),i=t.contact||{},o=document.getElementById("profile-modal-overlay"),a=document.getElementById("modal-title"),s=document.getElementById("modal-content");if(!o||!a||!s)return;a.textContent="Contact Information";const c=t.avatar||"./images/default-avatar.jpg";s.innerHTML=`\n    <div class="contact-card">\n      <div class="contact-card-header">\n        <img src="${g(c)}" alt="${g(n)}" class="contact-card-avatar" loading="lazy" decoding="async" />\n        <div>\n          <div class="contact-card-name">${g(n)}</div>\n          ${e?`<div class="contact-card-label">${g(e)}</div>`:""}\n        </div>\n      </div>\n      ${i.email?`\n        <div class="contact-info-item">\n          <span class="contact-info-icon">üìß</span>\n          <div>\n            <div class="contact-info-label">Email</div>\n            <div class="contact-info-value">\n              <a href="mailto:${g(i.email)}">${g(i.email)}</a>\n            </div>\n          </div>\n        </div>\n      `:""}\n      ${i.phone?`\n        <div class="contact-info-item">\n          <span class="contact-info-icon">üì±</span>\n          <div>\n            <div class="contact-info-label">Phone</div>\n            <div class="contact-info-value">\n              <a href="tel:${g(i.phone.replace(/\s/g,""))}">${g(i.phone)}</a>\n            </div>\n          </div>\n        </div>\n      `:""}\n      ${i.address?`\n        <div class="contact-info-item">\n          <span class="contact-info-icon">üìç</span>\n          <div>\n            <div class="contact-info-label">Address</div>\n            <div class="contact-info-value">${g(i.address)}</div>\n          </div>\n        </div>\n      `:""}\n      ${i.website?`\n        <div class="contact-info-item">\n          <span class="contact-info-icon">üåê</span>\n          <div>\n            <div class="contact-info-label">Website</div>\n            <div class="contact-info-value">\n              <a href="${g(i.website)}" target="_blank" rel="noopener noreferrer">${g(i.website)}</a>\n            </div>\n          </div>\n        </div>\n      `:""}\n      ${i.email||i.phone||i.address||i.website?"":'\n        <div class="contact-info-item">\n          <span class="contact-info-icon">‚ÑπÔ∏è</span>\n          <div class="contact-info-value">No contact information available</div>\n        </div>\n      '}\n    </div>\n  `,o.classList.add("active")}():async function(){E($.profileName);const t=document.getElementById("profile-modal-overlay"),n=document.getElementById("modal-title"),e=document.getElementById("modal-content");if(!t||!n||!e)return;n.textContent="Contributors";const i=function(t){const n=new Map;return $.documents.forEach(e=>{if(e.jurisdiction===t){const t=e.institution;n.set(t,(n.get(t)||0)+1)}}),Array.from(n.entries()).map(([t,n])=>({name:t,count:n})).sort((t,n)=>n.count-t.count)}($.profileName);if(0===i.length)e.innerHTML='\n      <div class="contact-info-item">\n        <span class="contact-info-icon">‚ÑπÔ∏è</span>\n        <div class="contact-info-value">No contributors found</div>\n      </div>\n    ';else{const t=await Promise.all(i.map(async t=>{const n=await m(t.name),e=n?.avatar||"./images/default-avatar.jpg",{name:i}=E(t.name);return`\n          <div class="contributor-item">\n            <img src="${g(e)}" alt="${g(i)}" class="contributor-avatar" loading="lazy" decoding="async" />\n            <div class="contributor-info">\n              <div class="contributor-name">${g(i)}</div>\n              <div class="contributor-count">${t.count} contribution${1!==t.count?"s":""}</div>\n            </div>\n            <a href="?institution=${encodeURIComponent(t.name)}" class="contributor-link">View</a>\n          </div>\n        `}));e.innerHTML=`\n      <div class="contributor-list">\n        ${t.join("")}\n      </div>\n    `}t.classList.add("active")}()}function k(){const t=document.getElementById("profile-modal-overlay");t&&t.classList.remove("active")}!function(){const t=document.getElementById("profile-modal-overlay"),n=document.getElementById("modal-close");n&&n.addEventListener("click",k),t&&t.addEventListener("click",n=>{n.target===t&&k()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&k()})}();let I="name",N=[],B=!1;function D(t){const n=document.getElementById("library");if(!n)return;const e=L(),i="institution"===e?.type,o=i||"jurisdiction"===e?.type;n.innerHTML="";let a="";if(o){const t="library-grid-profile";a=i?`\n<div class="library-row library-header ${t} gap-3 items-baseline text-left font-bold border-b border-black pb-1 mb-3">\n  <span class="overflow-hidden text-ellipsis whitespace-nowrap">Title</span>\n  <span class="text-right whitespace-nowrap">Posted in</span>\n</div>`:`\n<div class="library-row library-header ${t} gap-3 items-baseline text-left font-bold border-b border-black pb-1 mb-3">\n  <span class="overflow-hidden text-ellipsis whitespace-nowrap">Title</span>\n  <span class="text-right whitespace-nowrap">Posted by</span>\n</div>`}else{a=`\n<div class="library-row library-header ${"library-grid-default"} gap-4 items-start text-left font-bold border-b border-black pb-1 mb-3">\n  <span class="overflow-hidden text-ellipsis whitespace-nowrap">Title</span>\n  <span class="text-center tabular-nums">Version</span>\n  <span class="text-right whitespace-nowrap">Updated Date</span>\n</div>`}n.innerHTML=a,t.forEach(t=>{const e=function(t){const n=L(),e="institution"===n?.type,i="jurisdiction"===n?.type,o=e||i,a=document.createElement("div"),s=o?"library-grid-profile":"library-grid-default";a.className=`library-row ${s} gap-3 items-start border-b border-gray-200 py-2`,a.dataset.name=t.title,a.dataset.version=t.version,a.dataset.date=t.date,a.dataset.item=t.item,a.dataset.institution=t.institution,a.dataset.jurisdiction=t.jurisdiction;const c=document.createElement("span");c.className="overflow-hidden text-ellipsis whitespace-nowrap min-w-0";const r=document.createElement("a");r.href=t.filename,r.textContent=t.title,r.className="block overflow-hidden text-ellipsis whitespace-nowrap",c.appendChild(r);const l=document.createElement("span");if(e){l.className="library-metadata text-right whitespace-nowrap overflow-hidden text-sm text-ellipsis shrink-0";const n=(t.jurisdiction||"").replace(/\s*\[.*?\]\s*/g,"");l.innerHTML=`<span class="sm:hidden text-sm">Posted in </span>${g(n)}`}else{if(!i){const n=document.createElement("span");n.className="library-version text-center text-sm   tabular-nums",n.innerHTML=`<span class="sm:hidden text-sm">Version </span>${t.version}`;const e=document.createElement("span");return e.className="library-date text-right whitespace-nowrap",e.textContent=t.dateFormatted,a.appendChild(c),a.appendChild(n),a.appendChild(e),a}{l.className="library-metadata text-right whitespace-nowrap overflow-hidden text-sm text-ellipsis shrink-0";const n=(t.institution||"").replace(/\s*\[.*?\]\s*/g,"");l.innerHTML=`<span class="sm:hidden text-sm">Posted by </span>${g(n)}`}}return a.appendChild(c),a.appendChild(l),a}(t);n.appendChild(e)})}function M(t){document.querySelectorAll(".sort-controls button").forEach(n=>{n.classList.remove("active"),n.dataset.sort===t&&n.classList.add("active")})}async function S(t={},n=null){try{B=!!n||!!L(),B?document.body.classList.add("has-profile"):document.body.classList.remove("has-profile");const e=document.querySelector(".sort-controls-wrapper");e&&(B?e.classList.add("hidden"):e.classList.remove("hidden"));const i=document.getElementById("library-context");if(i&&(B?i.classList.add("hidden"):i.classList.remove("hidden")),0===N.length){const n=await f();N=b(n,t),N=y(N,I)}D(N),function(t){const n=document.getElementById("library-context");if(!n)return;const e=[];t.item&&e.push(t.item),t.institution&&e.push(t.institution),t.jurisdiction&&e.push(t.jurisdiction),0===e.length&&e.push("All"),n.textContent=e.join(" ¬∑ ")}(t),M(I),B||document.querySelectorAll(".sort-controls button").forEach(t=>{t.addEventListener("click",()=>{const n=t.dataset.sort;var e;n&&(I=e=n,N=y(N,e),D(N),M(e))})})}catch(t){!function(t){const n=document.createElement("div");n.className="error-message",n.style.cssText="\n    background: #fee;\n    border: 1px solid #fcc;\n    color: #c00;\n    padding: 1rem;\n    margin: 1rem;\n    border-radius: 4px;\n    text-align: center;\n  ",n.textContent=t,document.body.insertBefore(n,document.body.firstChild),setTimeout(()=>{n.remove()},5e3)}("Unable to load document library. Please try again later.")}}const q="darkMode";document.addEventListener("DOMContentLoaded",async()=>{!function(){const t=document.querySelector(".admin-seal");if(!t)return;const n=localStorage.getItem(q),e=window.matchMedia("(prefers-color-scheme: dark)").matches;("true"===n||!n&&e)&&document.documentElement.classList.add("dark"),t.addEventListener("click",()=>{document.documentElement.classList.toggle("dark");const t=document.documentElement.classList.contains("dark");localStorage.setItem(q,t)})}(),await async function(){const[t,n,e,i]=await Promise.all([l(),d(),u(),p()]);return{documents:t,institutions:n,jurisdictions:e,squircleIcons:i}}();const t=await f();let n=w();n.institution||n.jurisdiction||n.item||(n=h());const e=L();let i=t;if(i=b(i,n),e){await x(()=>{const t=C(),n=new Set(t.map(t=>t.id)),e=i.filter(t=>n.has(t.id));N=y(e,I),D(N),M(I)});const t=C(),n=new Set(t.map(t=>t.id));i=i.filter(t=>n.has(t.id))}i=y(i,"name"),N=i,S(n,e)});
