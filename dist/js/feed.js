class IndexedDBCache{constructor(t="ummah-cache",e="responses",i=1){this.dbName=t,this.storeName=e,this.version=i,this.db=null}async init(){return this.db?this.db:new Promise((t,e)=>{const i=indexedDB.open(this.dbName,this.version);i.onerror=()=>e(new Error(`Failed to open database: ${i.error}`)),i.onsuccess=()=>{this.db=i.result,t(this.db)},i.onupgradeneeded=t=>{const e=t.target.result;if(!e.objectStoreNames.contains(this.storeName)){const t=e.createObjectStore(this.storeName,{keyPath:"key"});t.createIndex("timestamp","timestamp",{unique:!1}),t.createIndex("ttl","ttl",{unique:!1})}}})}async get(t){try{const e=await this.init();return new Promise((i,a)=>{const n=e.transaction([this.storeName],"readonly").objectStore(this.storeName).get(t);n.onsuccess=()=>{const e=n.result;if(!e)return void i(null);Date.now()-e.timestamp<e.ttl?i(e.value):(this.delete(t).catch(console.warn),i(null))},n.onerror=()=>a(new Error(`Failed to get from cache: ${n.error}`))})}catch(t){return null}}async set(t,e,i=3e5){try{const a=await this.init();return new Promise((n,r)=>{const s=a.transaction([this.storeName],"readwrite"),o=s.objectStore(this.storeName),c={key:t,value:e,timestamp:Date.now(),ttl:i},l=o.put(c);l.onsuccess=()=>n(),l.onerror=()=>r(new Error(`Failed to set cache: ${l.error}`)),s.oncomplete=()=>n(),s.onerror=()=>r(new Error(`Transaction failed: ${s.error}`))})}catch(t){}}async getOrFetch(t,e,i){const a=await this.get(t);if(null!==a)return a;const n=await e();return await this.set(t,n,i),n}async getOrFetchStale(t,e,i,a=.8*i){try{const n=await this.init();return new Promise((r,s)=>{const o=n.transaction([this.storeName],"readonly").objectStore(this.storeName).get(t);o.onsuccess=()=>{const n=o.result;if(!n)return void e().then(e=>{this.set(t,e,i).catch(console.warn),r(e)}).catch(s);const c=Date.now()-n.timestamp;c<n.ttl?(c>a&&this.refreshInBackground(t,e,i),r(n.value)):(this.delete(t).catch(console.warn),e().then(e=>{this.set(t,e,i).catch(console.warn),r(e)}).catch(s))},o.onerror=()=>{e().then(e=>{this.set(t,e,i).catch(console.warn),r(e)}).catch(s)}})}catch(t){return e()}}async refreshInBackground(t,e,i){try{const a=await e();await this.set(t,a,i)}catch(t){}}async delete(t){try{const e=await this.init();return new Promise((i,a)=>{const n=e.transaction([this.storeName],"readwrite"),r=n.objectStore(this.storeName).delete(t);r.onsuccess=()=>i(),r.onerror=()=>a(new Error(`Failed to delete from cache: ${r.error}`)),n.oncomplete=()=>i(),n.onerror=()=>a(new Error(`Transaction failed: ${n.error}`))})}catch(t){}}async clear(){try{const t=await this.init();return new Promise((e,i)=>{const a=t.transaction([this.storeName],"readwrite"),n=a.objectStore(this.storeName).clear();n.onsuccess=()=>e(),n.onerror=()=>i(new Error(`Failed to clear cache: ${n.error}`)),a.oncomplete=()=>e(),a.onerror=()=>i(new Error(`Transaction failed: ${a.error}`))})}catch(t){}}async clearExpired(){try{const t=await this.init();return new Promise((e,i)=>{const a=t.transaction([this.storeName],"readwrite").objectStore(this.storeName).index("timestamp").openCursor();let n=0;const r=Date.now();a.onsuccess=t=>{const i=t.target.result;if(i){const t=i.value;r-t.timestamp>=t.ttl&&(i.delete(),n++),i.continue()}else e(n)},a.onerror=()=>i(new Error(`Failed to clear expired: ${a.error}`))})}catch(t){return 0}}async keys(){try{const t=await this.init();return new Promise((e,i)=>{const a=t.transaction([this.storeName],"readonly").objectStore(this.storeName).getAllKeys();a.onsuccess=()=>e(a.result),a.onerror=()=>i(new Error(`Failed to get keys: ${a.error}`))})}catch(t){return[]}}async getStats(){try{const t=await this.init();return new Promise((e,i)=>{const a=t.transaction([this.storeName],"readonly").objectStore(this.storeName).getAll();a.onsuccess=()=>{const t=a.result,i=Date.now();let n=0,r=0,s=0;t.forEach(t=>{const e=JSON.stringify(t).length;s+=e,i-t.timestamp<t.ttl?n++:r++}),e({totalEntries:t.length,validEntries:n,expiredEntries:r,totalBytes:s,totalKB:(s/1024).toFixed(2),avgEntrySize:t.length>0?(s/t.length).toFixed(2):0})},a.onerror=()=>i(new Error(`Failed to get stats: ${a.error}`))})}catch(t){return{totalEntries:0,validEntries:0,expiredEntries:0,totalBytes:0,totalKB:0,avgEntrySize:0}}}async close(){this.db&&(this.db.close(),this.db=null)}async deleteDatabase(){return await this.close(),new Promise((t,e)=>{const i=indexedDB.deleteDatabase(this.dbName);i.onsuccess=()=>t(),i.onerror=()=>e(new Error(`Failed to delete database: ${i.error}`))})}}const t="prayer",e="geocoding",i="location",a={PRAYER_TIMES:864e5};const n=new class{constructor(){this.memoryCache=new Map,this.idbCache=new IndexedDBCache("ummah-unified-cache","cache"),this.initialized=!1,this.initPromise=null}async init(){if(!this.initialized)return this.initPromise||(this.initPromise=this._doInit()),this.initPromise}async _doInit(){try{await this.idbCache.init(),this.initialized=!0}catch(t){this.initialized=!0}}generateKey(t,...e){return`${t}:${e.join(":")}`}generateLocationKey(t,e,i,...a){const n=e.toFixed(4),r=i.toFixed(4);return this.generateKey(t,n,r,...a)}async get(t){if(this.memoryCache.has(t)){const e=this.memoryCache.get(t);if(Date.now()-e.timestamp<e.ttl)return e.value;this.memoryCache.delete(t)}try{const e=await this.idbCache.get(t);if(null!==e)return this.memoryCache.set(t,{value:e,timestamp:Date.now(),ttl:a.PRAYER_TIMES}),e}catch(t){}return null}async set(t,e,i=a.PRAYER_TIMES){const n={value:e,timestamp:Date.now(),ttl:i};this.memoryCache.set(t,n);try{await this.idbCache.set(t,e,i)}catch(t){}}async delete(t){this.memoryCache.delete(t);try{await this.idbCache.delete(t)}catch(t){}}async invalidateNamespace(t){const e=t+":";for(const t of this.memoryCache.keys())t.startsWith(e)&&this.memoryCache.delete(t);try{const t=await this.idbCache.keys();for(const i of t)i.startsWith(e)&&await this.idbCache.delete(i)}catch(t){}}async clear(){this.memoryCache.clear();try{await this.idbCache.clear()}catch(t){}}async clearExpired(){let t=0;const e=Date.now();for(const[i,a]of this.memoryCache.entries())e-a.timestamp>=a.ttl&&(this.memoryCache.delete(i),t++);try{t+=await this.idbCache.clearExpired()}catch(t){}return t}async getStats(){const t=this.memoryCache.size;let e={totalEntries:0,validEntries:0,expiredEntries:0};try{e=await this.idbCache.getStats()}catch(t){}return{memoryEntries:t,...e,totalEntries:t+e.totalEntries}}async getOrFetch(t,e,i){const a=await this.get(t);if(null!==a)return a;const n=await e();return await this.set(t,n,i),n}async getOrFetchStale(t,e,i,a=.8*i){if(this.memoryCache.has(t)){const n=this.memoryCache.get(t),r=Date.now()-n.timestamp;if(r<n.ttl){const s=r>a;return s&&this._refreshInBackground(t,e,i),{value:n.value,isStale:s}}}try{const e=await this.idbCache.get(t);if(null!==e)return this.memoryCache.set(t,{value:e,timestamp:Date.now(),ttl:i}),{value:e,isStale:!0}}catch(t){}const n=await e();return await this.set(t,n,i),{value:n,isStale:!1}}async _refreshInBackground(t,e,i){try{const a=await e();await this.set(t,a,i)}catch(t){}}};"undefined"!=typeof window&&n.init().catch(console.warn);const r="gps_fresh",s="gps_cached",o="fallback",c={enableHighAccuracy:!1,timeout:1e4,maximumAge:3e5},l=["https://corsproxy.io/?","https://api.allorigins.win/raw?url="],d={latitude:-6.2088,longitude:106.8456,city:"Jakarta",country:"Indonesia"},h={LOCATION:18e5,GEOCODING:6048e5},u=["Fajr","Dhuhr","Asr","Maghrib","Isha"];const y=new class{constructor(){this.location=null,this.prayerTimes=null,this.nextPrayer=null,this.timeToNextPrayer=null,this.isLoading=!1,this.error=null,this.lastDate=null,this.listeners=new Set,this.initialized=!1,this.initPromise=null,this.updateInterval=null,this.handleOnline=this.handleOnline.bind(this),this.handleOffline=this.handleOffline.bind(this),this.handleVisibilityChange=this.handleVisibilityChange.bind(this)}async init(t={}){if(!this.initialized)return this.initPromise||(this.initPromise=this._doInit(t)),this.initPromise}async _doInit(t){try{this.isLoading=!0,this.notifyListeners("loading"),await n.init(),this.location=await this.getLocation({forceRefresh:t.forceRefresh}),this.prayerTimes=await this.fetchPrayerTimes(),this.calculateNextPrayer(),this.setupEventHandlers(),this.setupUpdateInterval(),this.setupDateChangeDetection(),this.initialized=!0,this.isLoading=!1,this.error=null,this.notifyListeners("initialized")}catch(t){throw this.error=t,this.isLoading=!1,this.notifyListeners("error",t),t}}async getLocation(t={}){const{forceRefresh:a=!1,maxAge:o=h.LOCATION}=t,c=n.generateKey(i,"current");if(!a){const t=await n.get(c);if(t&&this.isLocationFresh(t,o)){if((!t.city||"Unknown"===t.city)&&t.latitude&&t.longitude)try{const i=n.generateLocationKey(e,t.latitude,t.longitude),a=await n.get(i);a&&(t.city=a.city,t.country=a.country)}catch(t){}return{...t,quality:s}}}try{const t=await this.requestGPSPosition(),e={latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy,timestamp:Date.now(),quality:r};try{await this.fetchCityName(e)}catch(t){}return await n.set(c,e,h.LOCATION),e}catch(t){return this.getLocationFallback(t,c)}}requestGPSPosition(){return new Promise((t,e)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t,e,c):e(new Error("Geolocation not supported"))})}async getLocationFallback(t,i){const a=await this.getExpiredLocationCache(i);if(a&&a.quality!==o){if(!a.city||"Unknown"===a.city)try{const t=n.generateLocationKey(e,a.latitude,a.longitude),i=await n.get(t);i&&(a.city=i.city,a.country=i.country)}catch(t){}return{...a,quality:s,isExpired:!0}}return{...d,quality:o,fallbackReason:this.getGPSErrorMessage(t),timestamp:Date.now()}}async getExpiredLocationCache(t){try{if(!n.idbCache||!n.idbCache.db)return null;const e=n.idbCache.db;return new Promise(i=>{const a=e.transaction(["cache"],"readonly").objectStore("cache").get(t);a.onsuccess=()=>{const t=a.result;t&&t.value?i(t.value):i(null)},a.onerror=()=>i(null)})}catch(t){return null}}isLocationFresh(t,e){return!(!t||!t.timestamp)&&Date.now()-t.timestamp<e}getGPSErrorMessage(t){switch(t.code){case t.PERMISSION_DENIED:return"Permission denied";case t.POSITION_UNAVAILABLE:return"Position unavailable";case t.TIMEOUT:return"Request timed out";default:return t.message||"Unknown error"}}async fetchCityName(t){if(!t||t.quality===o)return;const i=n.generateLocationKey(e,t.latitude,t.longitude);try{const e=await n.get(i);if(e)return t.city=e.city,void(t.country=e.country)}catch(t){}try{const e=new AbortController,a=setTimeout(()=>e.abort(),5e3),r=await fetch(`/api/geocode?lat=${t.latitude}&lon=${t.longitude}`,{signal:e.signal});if(clearTimeout(a),r.ok){const e=await r.json();return t.city=e.city||"Unknown",t.country=e.country||"Unknown",await n.set(i,{city:t.city,country:t.country},h.GEOCODING),void await this.updateLocationCache(t)}}catch(t){}const a=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${t.latitude}&lon=${t.longitude}`;for(const e of l)try{const r=new AbortController,s=setTimeout(()=>r.abort(),5e3),o=await fetch(`${e}${encodeURIComponent(a)}`,{signal:r.signal});if(clearTimeout(s),!o.ok)continue;const c=await o.json();return t.city=c.address.city||c.address.town||c.address.village||c.address.county||"Unknown",t.country=c.address.country||"Unknown",await n.set(i,{city:t.city,country:t.country},h.GEOCODING),void await this.updateLocationCache(t)}catch(t){}t.city="Unknown",t.country="Unknown"}async updateLocationCache(t){if(!t)return;const e=n.generateKey(i,"current");try{await n.set(e,t,h.LOCATION)}catch(t){}}generatePrayerCacheKey(e){if(!e)return null;const i=(new Date).toLocaleDateString("en-CA",{timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone});return n.generateLocationKey(t,e.latitude,e.longitude,i,e.quality)}calculatePrayerTTL(){const t=new Date,e=Intl.DateTimeFormat().resolvedOptions().timeZone,i=t.toLocaleDateString("en-CA",{timeZone:e})+"T23:59:59",a=new Date(i).getTime()-t.getTime()+3e5;return Math.max(a,6e4)}async fetchPrayerTimes(t=this.location){if(!t)throw new Error("Location not available");const e=this.generatePrayerCacheKey(t);try{const i=await n.get(e);if(i){const e=new Date(i.date),a=new Date;if(e.toDateString()===a.toDateString()){const e=Date.now()-new Date(i.date).getTime();return e>72e6&&this.refreshPrayerTimesInBackground(t),i.prayerTimes}}}catch(t){}return this.fetchPrayerTimesFromAPI(t)}async fetchPrayerTimesFromAPI(t){const e=new Date,i=`https://api.aladhan.com/v1/timings/${e.getDate()}-${e.getMonth()+1}-${e.getFullYear()}?latitude=${t.latitude}&longitude=${t.longitude}&method=20`;try{const e=await fetch(i),a=await e.json();if(200===a.code&&a.data){const e={};return u.forEach(t=>{e[t]=a.data.timings[t]}),await this.cachePrayerTimes(t,e),e}throw new Error("Invalid API response")}catch(t){throw t}}async cachePrayerTimes(t,e){const i=this.generatePrayerCacheKey(t);if(!i)return;const a={date:(new Date).toISOString(),prayerTimes:e,location:{latitude:t.latitude,longitude:t.longitude,quality:t.quality}},r=this.calculatePrayerTTL();await n.set(i,a,r)}async refreshPrayerTimesInBackground(t=this.location){try{const e=await this.fetchPrayerTimesFromAPI(t);this.prayerTimes=e,this.notifyListeners("prayer-times-updated")}catch(t){}}calculateNextPrayer(){if(!this.prayerTimes)return null;const t=new Date,e=60*t.getHours()+t.getMinutes(),i=u.map(t=>{const[e,i]=this.prayerTimes[t].split(":").map(Number);return{name:t,time:this.prayerTimes[t],minutes:60*e+i}});let a=null;for(const t of i)if(t.minutes>e){a=t;break}if(a)this.timeToNextPrayer=a.minutes-e;else{a=i[0];const t=1440-e;this.timeToNextPrayer=t+a.minutes}return this.nextPrayer=a,a}formatTimeToNextPrayer(){if(null===this.timeToNextPrayer)return"";const t=Math.floor(this.timeToNextPrayer/60),e=this.timeToNextPrayer%60;return t>0?`${t}h ${e}m`:`${e}m`}formatDate(){return(new Date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})}formatCurrentTime(t=!1){const e={hour:"2-digit",minute:"2-digit",hour12:!0};return t&&(e.second="2-digit"),(new Date).toLocaleTimeString("en-US",e)}formatLocation(){if(!this.location)return"Unknown";return`${this.location.city||"Unknown"}, ${this.location.country||"Unknown"}${this.location.quality===o?" (Fallback)":""}`}getState(){return{location:this.location,prayerTimes:this.prayerTimes,nextPrayer:this.nextPrayer,timeToNextPrayer:this.timeToNextPrayer,formattedTimeToNext:this.formatTimeToNextPrayer(),isLoading:this.isLoading,error:this.error,formattedDate:this.formatDate(),formattedTime:this.formatCurrentTime(),formattedLocation:this.formatLocation()}}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notifyListeners(t,e){const i=this.getState();this.listeners.forEach(a=>{try{a(i,t,e)}catch(t){}})}setupEventHandlers(){window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline),document.addEventListener("visibilitychange",this.handleVisibilityChange)}handleOnline(){this.refreshPrayerTimesInBackground()}handleOffline(){}handleVisibilityChange(){"visible"===document.visibilityState&&(this.calculateNextPrayer(),this.notifyListeners("visibility-change"))}setupUpdateInterval(){this.updateInterval&&clearInterval(this.updateInterval),this.updateInterval=setInterval(()=>{this.calculateNextPrayer(),this.notifyListeners("tick")},1e3)}setupDateChangeDetection(){this.lastDate=(new Date).toDateString(),setInterval(()=>{const t=(new Date).toDateString();this.lastDate!==t&&(this.lastDate=t,this.invalidatePrayerTimesCache())},6e4)}async invalidateLocationCache(){await n.invalidateNamespace(i),this.location=null,this.notifyListeners("location-invalidated")}async invalidatePrayerTimesCache(){await n.invalidateNamespace(t),this.prayerTimes=null;try{this.prayerTimes=await this.fetchPrayerTimes(),this.calculateNextPrayer(),this.notifyListeners("prayer-times-updated")}catch(t){}}async invalidateAllCaches(){await this.invalidateLocationCache(),await this.invalidatePrayerTimesCache()}async forceRefresh(){this.isLoading=!0,this.notifyListeners("loading");try{this.location=await this.getLocation({forceRefresh:!0}),this.prayerTimes=await this.fetchPrayerTimesFromAPI(this.location),this.calculateNextPrayer(),this.error=null,this.isLoading=!1,this.notifyListeners("refreshed")}catch(t){this.error=t,this.isLoading=!1,this.notifyListeners("error",t)}}destroy(){this.updateInterval&&clearInterval(this.updateInterval),window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline),document.removeEventListener("visibilitychange",this.handleVisibilityChange),this.listeners.clear(),this.initialized=!1}},m="darkMode";function g(){const t=new URLSearchParams(window.location.search),e=t.get("institution"),i=t.get("jurisdiction");return e?{type:"institution",name:e}:i?{type:"jurisdiction",name:i}:{type:"global",name:"Global Feed"}}let w=null;async function p(){const t=document.getElementById("prayer-times-widget");if(t){t.innerHTML='\n    <div class="prayer-widget-header">\n      <h3 class="prayer-widget-title">Prayer Time Widget</h3>\n    </div>\n    <div class="prayer-widget-loading">\n      <span class="loading-spinner"></span>\n      <span>Fetching your location...</span>\n    </div>\n  ';try{w=y.subscribe((e,i)=>{!function(t,e,i){switch(e){case"loading":t.prayerTimes||(i.innerHTML='\n          <div class="prayer-widget-header">\n            <h3 class="prayer-widget-title">Prayer Time Widget</h3>\n          </div>\n          <div class="prayer-widget-loading">\n            <span class="loading-spinner"></span>\n            <span>Fetching your location...</span>\n          </div>\n        ');break;case"error":t.prayerTimes||(i.innerHTML=`\n          <div class="prayer-widget-header">\n            <h3 class="prayer-widget-title">Prayer Time Widget</h3>\n          </div>\n          <p class="text-center prayer-error">${t.error?.message||"Unable to load prayer times."}</p>\n        `);break;default:f()}}(e,i,t)}),await y.init(),f()}catch(e){t.innerHTML='<p class="text-center prayer-error">Unable to load prayer times.</p>'}}}function f(){const t=document.getElementById("prayer-times-widget");if(!t)return;const e=y.getState();if(e.isLoading&&!e.prayerTimes)return;if(e.error&&!e.prayerTimes)return;const i=e.location?.quality===o?"prayer-widget-location prayer-widget-location-fallback":"prayer-widget-location";t.innerHTML=`\n    <div class="prayer-widget-header">\n      <h3 class="prayer-widget-title">Prayer Time Widget</h3>\n    </div>\n    <div class="prayer-widget-header">\n      <span class="prayer-widget-date">${e.formattedDate}</span>\n      <span class="prayer-widget-clock">${e.formattedTime}</span>\n    </div>\n    <div class="${i}">üìç ${e.formattedLocation}</div>\n    <div class="prayer-widget-next">\n      <span class="prayer-widget-next-label">Next Prayer:</span> ${e.nextPrayer?.name||"Unknown"} (${e.formattedTimeToNext||"--"})\n    </div>\n    <div class="prayer-widget-times">\n      <div class="prayer-widget-column">\n        <span class="prayer-widget-name">Fajr</span>\n        <span class="prayer-widget-time">${e.prayerTimes?.Fajr||"--:--"}</span>\n      </div>\n      <div class="prayer-widget-column">\n        <span class="prayer-widget-name">Dhuhr</span>\n        <span class="prayer-widget-time">${e.prayerTimes?.Dhuhr||"--:--"}</span>\n      </div>\n      <div class="prayer-widget-column">\n        <span class="prayer-widget-name">Asr</span>\n        <span class="prayer-widget-time">${e.prayerTimes?.Asr||"--:--"}</span>\n      </div>\n      <div class="prayer-widget-column">\n        <span class="prayer-widget-name">Maghrib</span>\n        <span class="prayer-widget-time">${e.prayerTimes?.Maghrib||"--:--"}</span>\n      </div>\n      <div class="prayer-widget-column">\n        <span class="prayer-widget-name">Isha</span>\n        <span class="prayer-widget-time">${e.prayerTimes?.Isha||"--:--"}</span>\n      </div>\n    </div>\n  `}async function v(t=!1){const e=g(),i=document.getElementById("prayer-times-widget");"institution"===e.type?await async function(t,e,i=!1){try{const{getInstitutionFeedConfig:a,getDocumentById:n}=await import("./config-BsZ8KEZg.js"),r=await a(t);if(r?.widget?.enabled?await p():e&&(e.style.display="none"),r?.carousel){i&&b();const t=await Promise.all(r.carousel.images.map(async t=>{const e=t.document_id?await n(t.document_id):null;return{...t,document:e}})),e={...r.carousel,images:t};T(e,r.carousel.post_to_jurisdictions?.[0]||"","institution")}}catch(t){}}(e.name,i,t):"jurisdiction"===e.type?await async function(t,e,i=!1){try{const{getJurisdictionFeedConfig:a,getJurisdictionCarousels:n}=await import("./config-BsZ8KEZg.js"),r=await a(t);r?.widget?.enabled?await p():e&&(e.style.display="none"),i&&b();(await n(t)).forEach(t=>{T(t,t.institution,"jurisdiction")})}catch(t){}}(e.name,i,t):await p()}function b(){const t=document.querySelector(".paper-sheet");if(!t)return;t.querySelectorAll(".feed-carousel").forEach(t=>t.remove())}function T(t,e,i){try{const a=document.querySelector(".paper-sheet");if(!a)return;const n="institution"===i?`Posted in ${e.replace(/\s*\[.*?\]\s*/g,"").trim()}`:`Posted by ${e.replace(/\s*\[.*?\]\s*/g,"").trim()}`,r=`carousel-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,s=`\n      <div class="feed-carousel" id="${r}">\n        <div class="carousel-header">\n          <h3 class="carousel-title">${t.title}</h3>\n        </div>\n        <div class="carousel-container">\n          <div class="carousel-track" id="${r}-track">\n            ${t.images.map((t,e)=>{const i=t.document?.title||"Untitled",a=t.document?.filename||"#";return`\n              <div class="carousel-slide">\n                <img src="${t.url}" alt="${i}" loading="${0===e?"eager":"lazy"}" decoding="async" fetchpriority="${0===e?"high":"auto"}">\n                <div class="carousel-caption">\n                  <a href="${a}" class="carousel-caption-link">${i}</a>\n                </div>\n              </div>\n            `}).join("")}\n          </div>\n          <button class="carousel-nav prev" aria-label="Previous slide">‚Äπ</button>\n          <button class="carousel-nav next" aria-label="Next slide">‚Ä∫</button>\n        </div>\n        <div class="carousel-footer">\n          <div class="carousel-indicators">\n            ${t.images.map((t,e)=>`\n              <button class="carousel-indicator ${0===e?"active":""}" data-index="${e}" aria-label="Go to slide ${e+1}"></button>\n            `).join("")}\n          </div>\n          <span class="carousel-source">${n}</span>\n        </div>\n      </div>\n    `;a.insertAdjacentHTML("beforeend",s),function(t,e){const i=document.getElementById(t);if(!i)return;const a=document.getElementById(`${t}-track`),n=i.querySelector(".carousel-nav.prev"),r=i.querySelector(".carousel-nav.next"),s=i.querySelectorAll(".carousel-indicator");let o,c=0;function l(t){t<0&&(t=e-1),t>=e&&(t=0),c=t,a.style.transform=`translateX(-${100*c}%)`,s.forEach((t,e)=>{t.classList.toggle("active",e===c)})}function d(){l(c+1)}function h(){l(c-1)}function u(){o=setInterval(d,5e3)}function y(){clearInterval(o)}function m(){y(),u()}n.addEventListener("click",()=>{h(),m()}),r.addEventListener("click",()=>{d(),m()}),s.forEach((t,e)=>{t.addEventListener("click",()=>{l(e),m()})}),u(),i.addEventListener("mouseenter",y),i.addEventListener("mouseleave",u);let g=0,w=0;function p(){const t=50,e=g-w;Math.abs(e)>t&&(e>0?d():h())}i.addEventListener("touchstart",t=>{g=t.changedTouches[0].screenX,y()},{passive:!0}),i.addEventListener("touchend",t=>{w=t.changedTouches[0].screenX,p(),u()},{passive:!0})}(r,t.images.length)}catch(t){}}document.addEventListener("DOMContentLoaded",()=>{!function(){const t=document.querySelector(".admin-seal");if(!t)return;const e=localStorage.getItem(m),i=window.matchMedia("(prefers-color-scheme: dark)").matches;("true"===e||!e&&i)&&document.documentElement.classList.add("dark"),t.addEventListener("click",()=>{document.documentElement.classList.toggle("dark");const t=document.documentElement.classList.contains("dark");localStorage.setItem(m,t)})}(),function(){const t=g(),e=document.getElementById("feed-header");if(e)if("global"===t.type)e.textContent="Global Feed";else if("institution"===t.type){const i=t.name.replace(/\s*\[.*?\]\s*/g,"").trim();e.textContent=`${i} Feed`}else if("jurisdiction"===t.type){const i=t.name.replace(/\s*\[.*?\]\s*/g,"").trim();e.textContent=`${i} Feed`}}(),v(!1)}),window.addEventListener("pageshow",t=>{t.persisted&&v(!0)}),window.addEventListener("beforeunload",function(){w&&w()});
