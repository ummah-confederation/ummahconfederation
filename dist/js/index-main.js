const t="1.0.0";let n=null,i=null,e=null,s=null;let o={documents:0,institutions:0,jurisdictions:0,squircleIcons:0};function c(t){const n=Date.now();return o[t]&&n-o[t]<3e5}function a(t){o[t]=Date.now()}async function r(n,i=!0){const e=i?`?v=${t}&t=${Date.now()}`:`?t=${Date.now()}`;return fetch(n+e,{cache:"no-store",headers:{Accept:"application/json"}})}async function l(){if(n&&c("documents"))return n;try{const t=await r("config/documents-config.json");if(!t.ok)throw new Error(`Failed to load config: ${t.status} ${t.statusText}`);const i=await t.json();return n=i,a("documents"),i}catch(t){throw t}}async function u(){if(i&&c("institutions"))return i;try{const t=await r("config/institution-config.json");if(!t.ok)throw new Error(`Failed to load institution config: ${t.status} ${t.statusText}`);const n=await t.json();return i=n,a("institutions"),n}catch(t){return{institutions:{}}}}async function d(){if(e&&c("jurisdictions"))return e;try{const t=await r("config/jurisdiction-config.json");if(!t.ok)throw new Error(`Failed to load jurisdiction config: ${t.status} ${t.statusText}`);const n=await t.json();return e=n,a("jurisdictions"),n}catch(t){return{jurisdictions:{}}}}async function m(){return(await l()).documents.filter(t=>!1!==t.visible)}async function f(){const t=await m();return[...new Set(t.map(t=>t.item))].sort((t,n)=>t.localeCompare(n))}async function w(){const t=await m();return[...new Set(t.map(t=>t.institution))].sort((t,n)=>t.localeCompare(n))}async function v(){const t=await m();return[...new Set(t.map(t=>t.jurisdiction))].sort((t,n)=>t.localeCompare(n))}async function y(){if(s&&c("squircleIcons"))return s;try{const t=await r("config/squircle-icons-config.json");if(!t.ok)throw new Error(`Failed to load squircle icons config: ${t.status} ${t.statusText}`);const n=await t.json();return s=n,a("squircleIcons"),n}catch(t){return{icons:{}}}}function g(){n=null,i=null,e=null,s=null,o={documents:0,institutions:0,jurisdictions:0,squircleIcons:0}}function h(t,n,i=!1){return i?"library.html":`library.html?${t}=${encodeURIComponent(n)}`}"undefined"!=typeof window&&(window.clearConfigCache=g,window.getCacheVersion=function(){return t},window.setCacheVersion=function(t){g()});let p=null;function b(){document.querySelectorAll(".tab-btn").forEach(t=>{t.addEventListener("click",async()=>{const n=t.dataset.tab;if(function(t){document.querySelectorAll(".tab-content").forEach(t=>{t.classList.add("hidden")});const n=document.getElementById(`${t}-tab`);n&&n.classList.remove("hidden")}(n),function(t){const n=document.querySelectorAll(".tab-btn");n.forEach(n=>{n.dataset.tab===t?(n.classList.add("active","bg-white","shadow-sm","text-gray-900"),n.classList.remove("text-gray-600")):(n.classList.remove("active","bg-white","shadow-sm","text-gray-900"),n.classList.add("text-gray-600"))})}(n),"account"===n){const t=p?[...new Set(p.documents.documents.filter(t=>!1!==t.visible).map(t=>t.institution))].sort():await w(),n=p?p.documents.documents.filter(t=>!1!==t.visible):await m();await C(t,n)}else if("space"===n){const t=p?[...new Set(p.documents.documents.filter(t=>!1!==t.visible).map(t=>t.jurisdiction))].sort():await v(),n=p?p.documents.documents.filter(t=>!1!==t.visible):await m();await E(t,n)}else if("content"===n){const t=p?[...new Set(p.documents.documents.filter(t=>!1!==t.visible).map(t=>t.item))].sort():await f();await j(t)}})}),async function(){try{p=await async function(){const[t,n,i,e]=await Promise.all([l(),u(),d(),y()]);return{documents:t,institutions:n,jurisdictions:i,squircleIcons:e}}(),await async function(){try{const t=p?[...new Set(p.documents.documents.filter(t=>!1!==t.visible).map(t=>t.item))].sort():await f(),n=p?[...new Set(p.documents.documents.filter(t=>!1!==t.visible).map(t=>t.institution))].sort():await w(),i=p?[...new Set(p.documents.documents.filter(t=>!1!==t.visible).map(t=>t.jurisdiction))].sort():await v(),e=p?p.documents.documents.filter(t=>!1!==t.visible):await m();await j(t),await C(n,e),await E(i,e)}catch(t){}}()}catch(t){}}()}async function j(t){const n=document.getElementById("content-gallery");if(!n)return;n.innerHTML="";const i=document.createElement("a");i.href=h("item","All",!0),i.className="squircle-item",i.innerHTML='\n  <div class="squircle">\n    <span class="squircle-emoji">ðŸ“‚</span>\n  </div>\n  <span class="squircle-label">All</span>\n ',n.appendChild(i);const e=p?.squircleIcons?.icons||{},s={};Object.keys(e).forEach(t=>{s[t.toLowerCase()]=e[t]});for(const i of t){const t=document.createElement("a");t.href=h("item",i),t.className="squircle-item";const o=e[i]?.emoji||s[i.toLowerCase()]?.emoji||"ðŸ“„";t.innerHTML=`\n  <div class="squircle">\n    <span class="squircle-emoji">${o}</span>\n  </div>\n  <span class="squircle-label">${i}</span>\n `,n.appendChild(t)}}function $(t){const n=t.match(/\[(.*?)\]/),i=n?n[1]:t.replace(/^Ummah\s+/,"");return{displayName:t.replace(/\s*\[.*?\]\s*$/,""),label:i}}async function C(t,n){const i=document.getElementById("account-gallery");if(!i)return;i.innerHTML="";const e=p?.institutions?.institutions||{},s=[];for(const i of t){const t=n.filter(t=>t.institution===i).length;s.push({institution:i,docCount:t})}s.sort((t,n)=>n.docCount-t.docCount);for(const{institution:t,docCount:n}of s){const{displayName:s,label:o}=$(t),c=e[t]||null,a=c?.avatar||null,r=c?.cover||null,l=document.createElement("a");l.href=h("institution",t),l.className="id-card";const u=r||"./images/default-cover.jpg",d=a||"./images/default-avatar.jpg";l.innerHTML=`\n      <div\n        class="id-card-cover"\n        style="background-image: url('${u}'); background-size: cover; background-position: center;"\n      >\n        <div class="id-card-avatar">\n          <img src="${d}" alt="${s}" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy" decoding="async" onerror="this.style.display='none'">\n        </div>\n      </div>\n      <div class="id-card-content">\n        <div class="id-card-name">${s}</div>\n        <div class="id-card-label">${o}</div>\n        <div class="id-card-count">${n} contribution${1!==n?"s":""}</div>\n      </div>\n    `,i.appendChild(l)}}async function E(t,n){const i=document.getElementById("space-gallery");if(!i)return;i.innerHTML="";const e=p?.jurisdictions?.jurisdictions||{},s=[];for(const i of t){const t=i.match(/\[(.*?)\]/),e=t?t[1]:"Community",o=i.replace(/\s*\[.*?\]\s*$/,""),c=n.filter(t=>t.jurisdiction===i),a=new Set(c.map(t=>t.institution)).size;s.push({jurisdiction:i,displayName:o,label:e,contributorCount:a})}s.sort((t,n)=>n.contributorCount-t.contributorCount);for(const{jurisdiction:t,displayName:n,label:o,contributorCount:c}of s){const s=e[t]||null,a=s?.avatar||null,r=s?.cover||null,l=document.createElement("a");l.href=h("jurisdiction",t),l.className="id-card";const u=r||"./images/default-cover.jpg",d=a||"./images/default-avatar.jpg";l.innerHTML=`\n      <div\n        class="id-card-cover"\n        style="background-image: url('${u}'); background-size: cover; background-position: center;"\n      >\n        <div class="id-card-avatar">\n          <img src="${d}" alt="${n}" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy" decoding="async" onerror="this.style.display='none'">\n        </div>\n      </div>\n      <div class="id-card-content">\n        <div class="id-card-name">${n}</div>\n        <div class="id-card-label">${o}</div>\n        <div class="id-card-count">${c} contributor${1!==c?"s":""}</div>\n      </div>\n    `,i.appendChild(l)}}const L="darkMode";document.addEventListener("DOMContentLoaded",()=>{!function(){const t=document.querySelector(".admin-seal");if(!t)return;const n=localStorage.getItem(L),i=window.matchMedia("(prefers-color-scheme: dark)").matches;("true"===n||!n&&i)&&document.documentElement.classList.add("dark"),t.addEventListener("click",()=>{document.documentElement.classList.toggle("dark");const t=document.documentElement.classList.contains("dark");localStorage.setItem(L,t)})}(),b()});
